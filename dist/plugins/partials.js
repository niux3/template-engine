const d=(c,r)=>{const o=new Map;c.partial=(a,e)=>(o.set(a,e),c),r.extraParams||(r.extraParams=[]),r.extraArgs||(r.extraArgs=[]),r.extraParams.push("__e","__p"),r.extraArgs.push(c,o),r.preprocessors||(r.preprocessors=[]);const g=(a,e)=>`[[- (function(){const t=__p.get(${a});if(!t)throw new Error('Partial "'+${a}+'" not found');return __e.render(t,${e})})() ]]`;r.preprocessors.push(a=>{let e=a;e=e.replace(/\[\[>\s*([a-zA-Z0-9_-]+)\s+((?:[a-zA-Z0-9_-]+="[^"]*"\s*)+)\]\]/g,(u,t,i)=>{const s=Object.fromEntries([...i.matchAll(/([a-zA-Z0-9_-]+)="([^"]*)"/g)].map(([,p,n])=>[p,n==="true"?!0:n==="false"?!1:isNaN(n)||n===""?n:+n]));return g(`'${t}'`,`Object.assign({},data,${JSON.stringify(s)})`)}),e=e.replace(/\[\[>\s*\(\s*([a-zA-Z0-9_.-]*)\s*\)\s*\]\]/g,(u,t)=>{if(!t)return"";const i=t.includes(".")?t.split(".").map((n,f)=>f===0?n:`?.${n}`).join(""):t,s=t.includes(".")?t.split(".")[0]:null,p=s?`(typeof ${s}==='object'?Object.assign({},data,${s}):data)`:"data";return`[[- (function(){try{const n=${i};if(typeof n!=='string')return '';const t=__p.get(n);if(!t)throw new Error('Partial "'+n+'" not found');return __e.render(t,${p})}catch(e){if(e.message&&(e.message.includes('Partial')||e.message.includes('not defined')))throw e;return ''}})() ]]`});const l=(u,t=0)=>{if(t>10)throw new Error("Partial nesting too deep (max 10 levels)");return u.replace(/\[\[>\s*(\w+)\s*\]\]/g,(i,s)=>{if(!o.has(s))throw new Error(`Partial "${s}" not found`);return l(o.get(s),t+1)})};return l(e)})};export{d as PartialsPlugin};
