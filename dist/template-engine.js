var E=s=>{throw TypeError(s)};var T=(s,t,r)=>t.has(s)||E("Cannot "+r);var e=(s,t,r)=>(T(s,t,"read from private field"),r?r.call(s):t.get(s)),o=(s,t,r)=>t.has(s)?E("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,r);var x=(s,t,r)=>(T(s,t,"access private method"),r);var a,l,w,g,m,f,h,d,y;class S{constructor(){o(this,d);o(this,a,new Map);o(this,l,100);o(this,w,{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});o(this,g,/[&<>"']/g);o(this,m,t=>String(t).replace(e(this,g),r=>e(this,w)[r]));o(this,f,[]);o(this,h,{})}use(t){return t(this,e(this,h)),e(this,f).push(t),this}render(t,r={}){if(!t)throw new Error("Template required");try{const n=[r,e(this,m),...e(this,h).extraArgs||[]];return x(this,d,y).call(this,t)(...n)}catch(n){throw new Error(`Template render failed: ${n.message}`)}}clear(){return e(this,a).clear(),this}}a=new WeakMap,l=new WeakMap,w=new WeakMap,g=new WeakMap,m=new WeakMap,f=new WeakMap,h=new WeakMap,d=new WeakSet,y=function(t){const r=t;if(e(this,a).has(r))return e(this,a).get(r);let n=t;e(this,h).preprocessors&&e(this,h).preprocessors.forEach(i=>{n=i(n)});const M=/\[\[=?-?([\s\S]+?)\]\]|([^\[]+)/g;let c,p=`let output="";
`;for(;c=M.exec(n);)if(c[1]){const i=c[1].trim(),u=c[0].slice(0,3);p+=u==="[[="?`output+=escapeHTML(${i});
`:u==="[[-"?`output+=${i};
`:`${i}
`}else c[2]&&(p+=`output+=${JSON.stringify(c[2])};
`);p+="return output;";let $=`with(data) { ${p} }`;e(this,h).wrappers&&e(this,h).wrappers.forEach(i=>{$=i($,p)});try{const i=["data","escapeHTML",...e(this,h).extraParams||[]],u=new Function(...i,$);return e(this,a).size>=e(this,l)&&e(this,a).delete(e(this,a).keys().next().value),e(this,a).set(r,u),u}catch(i){throw new Error(`Template compilation failed: ${i.message}`)}};export{S as TemplateEngine};
